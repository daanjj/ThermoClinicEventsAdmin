<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <style>
      .container { padding: 20px; }
      .form-group { margin-bottom: 15px; }
      label { font-weight: bold; display: block; margin-bottom: 5px; }
      select, button { width: 100%; }
      .loader {
        border: 4px solid #f3f3f3;
        border-radius: 50%;
        border-top: 4px solid #3498db;
        width: 20px;
        height: 20px;
        animation: spin 2s linear infinite;
        display: none; /* Hidden by default */
        margin: 10px auto;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="form-group">
        <label for="clinic-select">Selecteer de clinic</label>
        <p style="font-size: 0.9em; margin-top: 0;">Er wordt een reminder gestuurd naar alle deelnemers van de geselecteerde clinic die installatie van de CORE-app nog niet hebben bevestigd.</p>
        <select id="clinic-select">
          <? if (clinics && clinics.length > 0) { ?>
            <option value="" disabled selected>-- Maak een keuze --</option>
            <? for (var i = 0; i < clinics.length; i++) { ?>
              <option value="<?= clinics[i] ?>"><?= clinics[i] ?></option>
            <? } ?>
          <? } else { ?>
            <option value="" disabled>Geen clinics met deelnemers gevonden</option>
          <? } ?>
        </select>
      </div>

      <div class="form-group">
        <button id="send-button" class="action" onclick="sendReminders()">Verstuur reminders</button>
      </div>
      
      <div id="loader" class="loader"></div>
      <div id="status"></div>
    </div>

    <script>
      function sendReminders() {
        var sendButton = document.getElementById('send-button');
        var loader = document.getElementById('loader');
        var statusDiv = document.getElementById('status');
        
        var clinicSelect = document.getElementById('clinic-select');
        var selectedClinic = clinicSelect.value;
        
        if (!selectedClinic) {
          statusDiv.textContent = 'Selecteer a.u.b. een clinic.';
          return;
        }

        sendButton.disabled = true;
        loader.style.display = 'block';
        statusDiv.textContent = 'Bezig met versturen... Dit kan even duren.';

        google.script.run
          .withSuccessHandler(onSuccess)
          .withFailureHandler(onFailure)
          .sendCoreAppReminder(selectedClinic);
      }

      function onSuccess() {
        // The server-side function shows an alert with the result.
        // We just need to close the dialog.
        google.script.host.close();
      }

      function onFailure(error) {
        var sendButton = document.getElementById('send-button');
        var loader = document.getElementById('loader');
        var statusDiv = document.getElementById('status');
        
        sendButton.disabled = false;
        loader.style.display = 'none';
        statusDiv.innerHTML = '<strong>Fout:</strong> ' + error.message;
      }
    </script>
  </body>
</html>